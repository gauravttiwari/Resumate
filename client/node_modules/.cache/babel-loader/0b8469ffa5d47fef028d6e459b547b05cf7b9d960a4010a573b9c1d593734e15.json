{"ast":null,"code":"import Mustache from 'mustache';\n\n/**\r\n * Enhanced Mustache rendering function that ensures LaTeX document structure integrity\r\n * by preventing user data from being inserted before \\begin{document}\r\n * and fixing common LaTeX syntax errors\r\n * \r\n * @param {string} template - The LaTeX template to render\r\n * @param {object} data - The data to inject into the template\r\n * @returns {string} - The rendered LaTeX document with proper structure\r\n */\nexport const safeRenderLatex = (template, data) => {\n  if (!template || typeof template !== 'string') {\n    return '';\n  }\n\n  // First, find the position of \\begin{document} in the template\n  const beginDocPos = template.indexOf('\\\\begin{document}');\n  if (beginDocPos === -1) {\n    console.error('Template is missing \\\\begin{document} tag');\n    return template; // Return original template if no begin document tag\n  }\n\n  // Split the template into preamble and body\n  const preamble = template.substring(0, beginDocPos + '\\\\begin{document}'.length);\n  const body = template.substring(beginDocPos + '\\\\begin{document}'.length);\n\n  // Process body with Mustache to replace variables with user data\n  let renderedBody = Mustache.render(body, data);\n\n  // Before returning, check if there are any mustache tags in the preamble\n  if (preamble.includes('{{') || preamble.includes('{{{')) {\n    console.warn('Warning: Found mustache tags in LaTeX preamble. These will not be processed.');\n  }\n\n  // Fix common LaTeX syntax errors in the rendered document\n  renderedBody = fixLatexSyntaxErrors(renderedBody);\n\n  // Combine the untouched preamble with the rendered body\n  return preamble + renderedBody;\n};\n\n/**\r\n * Fixes common LaTeX syntax errors in the rendered document\r\n * \r\n * @param {string} latex - The LaTeX content to fix\r\n * @returns {string} - The fixed LaTeX content\r\n */\nconst fixLatexSyntaxErrors = latex => {\n  if (!latex) return latex;\n  let fixed = latex;\n\n  // Fix image tags that are missing braces\n  fixed = fixed.replace(/\\\\includegraphics(\\[[^\\]]*\\])?(data:)/g, '\\\\includegraphics$1{$2');\n  fixed = fixed.replace(/\\\\includegraphics(\\[[^\\]]*\\])?([^{])/g, '\\\\includegraphics$1{$2');\n\n  // Fix \\textbf without braces (e.g., \\textbftext -> \\textbf{text})\n  fixed = fixed.replace(/\\\\textbf(\\w+)/g, '\\\\textbf{$1}');\n\n  // Fix \\textit without braces\n  fixed = fixed.replace(/\\\\textit(\\w+)/g, '\\\\textit{$1}');\n\n  // Fix missing closing braces for includegraphics with data URLs\n  const imgMatches = fixed.match(/\\\\includegraphics(\\[[^\\]]*\\])?{data:[^}]+/g);\n  if (imgMatches) {\n    imgMatches.forEach(match => {\n      if (!match.endsWith('}')) {\n        const fixedMatch = match + '}';\n        fixed = fixed.replace(match, fixedMatch);\n      }\n    });\n  }\n\n  // Generic fix for common LaTeX commands missing braces\n  const latexCommands = ['\\\\textbf', '\\\\textit', '\\\\textrm', '\\\\textsc', '\\\\textsl', '\\\\texttt', '\\\\emph', '\\\\underline'];\n  latexCommands.forEach(cmd => {\n    // Match command followed by text without braces\n    const regex = new RegExp(cmd + '([^{\\\\s][^\\\\s]*)', 'g');\n    fixed = fixed.replace(regex, cmd + '{$1}');\n  });\n  return fixed;\n};\nexport default safeRenderLatex;","map":{"version":3,"names":["Mustache","safeRenderLatex","template","data","beginDocPos","indexOf","console","error","preamble","substring","length","body","renderedBody","render","includes","warn","fixLatexSyntaxErrors","latex","fixed","replace","imgMatches","match","forEach","endsWith","fixedMatch","latexCommands","cmd","regex","RegExp"],"sources":["C:/Users/dell/OneDrive/Desktop/resumate/client/src/safeLatexRenderer.js"],"sourcesContent":["import Mustache from 'mustache';\r\n\r\n/**\r\n * Enhanced Mustache rendering function that ensures LaTeX document structure integrity\r\n * by preventing user data from being inserted before \\begin{document}\r\n * and fixing common LaTeX syntax errors\r\n * \r\n * @param {string} template - The LaTeX template to render\r\n * @param {object} data - The data to inject into the template\r\n * @returns {string} - The rendered LaTeX document with proper structure\r\n */\r\nexport const safeRenderLatex = (template, data) => {\r\n  if (!template || typeof template !== 'string') {\r\n    return '';\r\n  }\r\n\r\n  // First, find the position of \\begin{document} in the template\r\n  const beginDocPos = template.indexOf('\\\\begin{document}');\r\n  \r\n  if (beginDocPos === -1) {\r\n    console.error('Template is missing \\\\begin{document} tag');\r\n    return template; // Return original template if no begin document tag\r\n  }\r\n  \r\n  // Split the template into preamble and body\r\n  const preamble = template.substring(0, beginDocPos + '\\\\begin{document}'.length);\r\n  const body = template.substring(beginDocPos + '\\\\begin{document}'.length);\r\n  \r\n  // Process body with Mustache to replace variables with user data\r\n  let renderedBody = Mustache.render(body, data);\r\n  \r\n  // Before returning, check if there are any mustache tags in the preamble\r\n  if (preamble.includes('{{') || preamble.includes('{{{')) {\r\n    console.warn('Warning: Found mustache tags in LaTeX preamble. These will not be processed.');\r\n  }\r\n  \r\n  // Fix common LaTeX syntax errors in the rendered document\r\n  renderedBody = fixLatexSyntaxErrors(renderedBody);\r\n  \r\n  // Combine the untouched preamble with the rendered body\r\n  return preamble + renderedBody;\r\n};\r\n\r\n/**\r\n * Fixes common LaTeX syntax errors in the rendered document\r\n * \r\n * @param {string} latex - The LaTeX content to fix\r\n * @returns {string} - The fixed LaTeX content\r\n */\r\nconst fixLatexSyntaxErrors = (latex) => {\r\n  if (!latex) return latex;\r\n  \r\n  let fixed = latex;\r\n  \r\n  // Fix image tags that are missing braces\r\n  fixed = fixed.replace(/\\\\includegraphics(\\[[^\\]]*\\])?(data:)/g, '\\\\includegraphics$1{$2');\r\n  fixed = fixed.replace(/\\\\includegraphics(\\[[^\\]]*\\])?([^{])/g, '\\\\includegraphics$1{$2');\r\n  \r\n  // Fix \\textbf without braces (e.g., \\textbftext -> \\textbf{text})\r\n  fixed = fixed.replace(/\\\\textbf(\\w+)/g, '\\\\textbf{$1}');\r\n  \r\n  // Fix \\textit without braces\r\n  fixed = fixed.replace(/\\\\textit(\\w+)/g, '\\\\textit{$1}');\r\n  \r\n  // Fix missing closing braces for includegraphics with data URLs\r\n  const imgMatches = fixed.match(/\\\\includegraphics(\\[[^\\]]*\\])?{data:[^}]+/g);\r\n  if (imgMatches) {\r\n    imgMatches.forEach(match => {\r\n      if (!match.endsWith('}')) {\r\n        const fixedMatch = match + '}';\r\n        fixed = fixed.replace(match, fixedMatch);\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Generic fix for common LaTeX commands missing braces\r\n  const latexCommands = ['\\\\textbf', '\\\\textit', '\\\\textrm', '\\\\textsc', '\\\\textsl', '\\\\texttt', '\\\\emph', '\\\\underline'];\r\n  latexCommands.forEach(cmd => {\r\n    // Match command followed by text without braces\r\n    const regex = new RegExp(cmd + '([^{\\\\s][^\\\\s]*)', 'g');\r\n    fixed = fixed.replace(regex, cmd + '{$1}');\r\n  });\r\n  \r\n  return fixed;\r\n};\r\n\r\nexport default safeRenderLatex;\r\n"],"mappings":"AAAA,OAAOA,QAAQ,MAAM,UAAU;;AAE/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,eAAe,GAAGA,CAACC,QAAQ,EAAEC,IAAI,KAAK;EACjD,IAAI,CAACD,QAAQ,IAAI,OAAOA,QAAQ,KAAK,QAAQ,EAAE;IAC7C,OAAO,EAAE;EACX;;EAEA;EACA,MAAME,WAAW,GAAGF,QAAQ,CAACG,OAAO,CAAC,mBAAmB,CAAC;EAEzD,IAAID,WAAW,KAAK,CAAC,CAAC,EAAE;IACtBE,OAAO,CAACC,KAAK,CAAC,2CAA2C,CAAC;IAC1D,OAAOL,QAAQ,CAAC,CAAC;EACnB;;EAEA;EACA,MAAMM,QAAQ,GAAGN,QAAQ,CAACO,SAAS,CAAC,CAAC,EAAEL,WAAW,GAAG,mBAAmB,CAACM,MAAM,CAAC;EAChF,MAAMC,IAAI,GAAGT,QAAQ,CAACO,SAAS,CAACL,WAAW,GAAG,mBAAmB,CAACM,MAAM,CAAC;;EAEzE;EACA,IAAIE,YAAY,GAAGZ,QAAQ,CAACa,MAAM,CAACF,IAAI,EAAER,IAAI,CAAC;;EAE9C;EACA,IAAIK,QAAQ,CAACM,QAAQ,CAAC,IAAI,CAAC,IAAIN,QAAQ,CAACM,QAAQ,CAAC,KAAK,CAAC,EAAE;IACvDR,OAAO,CAACS,IAAI,CAAC,8EAA8E,CAAC;EAC9F;;EAEA;EACAH,YAAY,GAAGI,oBAAoB,CAACJ,YAAY,CAAC;;EAEjD;EACA,OAAOJ,QAAQ,GAAGI,YAAY;AAChC,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,MAAMI,oBAAoB,GAAIC,KAAK,IAAK;EACtC,IAAI,CAACA,KAAK,EAAE,OAAOA,KAAK;EAExB,IAAIC,KAAK,GAAGD,KAAK;;EAEjB;EACAC,KAAK,GAAGA,KAAK,CAACC,OAAO,CAAC,wCAAwC,EAAE,wBAAwB,CAAC;EACzFD,KAAK,GAAGA,KAAK,CAACC,OAAO,CAAC,uCAAuC,EAAE,wBAAwB,CAAC;;EAExF;EACAD,KAAK,GAAGA,KAAK,CAACC,OAAO,CAAC,gBAAgB,EAAE,cAAc,CAAC;;EAEvD;EACAD,KAAK,GAAGA,KAAK,CAACC,OAAO,CAAC,gBAAgB,EAAE,cAAc,CAAC;;EAEvD;EACA,MAAMC,UAAU,GAAGF,KAAK,CAACG,KAAK,CAAC,4CAA4C,CAAC;EAC5E,IAAID,UAAU,EAAE;IACdA,UAAU,CAACE,OAAO,CAACD,KAAK,IAAI;MAC1B,IAAI,CAACA,KAAK,CAACE,QAAQ,CAAC,GAAG,CAAC,EAAE;QACxB,MAAMC,UAAU,GAAGH,KAAK,GAAG,GAAG;QAC9BH,KAAK,GAAGA,KAAK,CAACC,OAAO,CAACE,KAAK,EAAEG,UAAU,CAAC;MAC1C;IACF,CAAC,CAAC;EACJ;;EAEA;EACA,MAAMC,aAAa,GAAG,CAAC,UAAU,EAAE,UAAU,EAAE,UAAU,EAAE,UAAU,EAAE,UAAU,EAAE,UAAU,EAAE,QAAQ,EAAE,aAAa,CAAC;EACvHA,aAAa,CAACH,OAAO,CAACI,GAAG,IAAI;IAC3B;IACA,MAAMC,KAAK,GAAG,IAAIC,MAAM,CAACF,GAAG,GAAG,kBAAkB,EAAE,GAAG,CAAC;IACvDR,KAAK,GAAGA,KAAK,CAACC,OAAO,CAACQ,KAAK,EAAED,GAAG,GAAG,MAAM,CAAC;EAC5C,CAAC,CAAC;EAEF,OAAOR,KAAK;AACd,CAAC;AAED,eAAejB,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}